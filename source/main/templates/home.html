{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ada</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <!-- Top navigation bar approximating the original header -->
  <header class="top-nav">
    <div class="left">
      <div class="logo-text">Scientific Computing</div>
      <div class="logo-separator"></div>
      <div class="logo-text">Ada Lovelace Centre</div>
    </div>
    <div class="right">
      <!-- Optional right-side items -->
    </div>
  </header>

  <!-- Hero section with large icon and introduction -->
  <section class="home-hero">
    <img src="{% static 'images/atom.png' %}" alt="Atom" class="hero-icon">
    <div class="hero-content">
      <h1 class="hero-title">Ada</h1>
      <p class="hero-description">
        Welcome to Ada (previously known as DAaaS). This service enables remote data access and creation of Workspaces, providing all necessary software, data, and compute resources for your analysis. Ada offers access to the data generated by the ISIS Neutron and Muon Source and the Central Laser Facility (CLF). We also host various training courses, giving course attendees access to Workspaces for practical experience using software for analysis.
      </p>
    </div>
  </section>

  <!-- SCI Score (Home) -->
  <section class="sci-card" data-sci-url="{% url 'sci_score_api' %}">
    <div class="sci-head">
      <div>
        <div class="sci-title">SCI Score</div>
        <div class="sci-caption">lower is better</div>
      </div>
      <button id="sciHelpBtn" class="sci-help-btn"
              aria-haspopup="dialog" aria-expanded="false"
              aria-controls="sciHelp" title="What is SCI?">?</button>
    </div>
  
    <!-- Help popover (kept) -->
    <div class="sci-popover hidden" id="sciHelp" role="dialog" aria-modal="true" aria-label="About SCI Score">
      <button class="sci-popover-close" id="sciHelpClose" aria-label="Close">×</button>
      <h4>What is SCI?</h4>
      <p>SCI is carbon per functional unit (FU). Here FU = one compute-hour.</p>
      <ol class="sci-popover-list">
        <li><strong>Operational</strong> = electricity (kWh) × grid CI (g/kWh ÷ 1000).</li>
        <li><strong>Embodied</strong> = manufacturing/infra emissions amortized over lifetime (kg ÷ hours).</li>
        <li><strong>SCI</strong> = Operational + Embodied.</li>
      </ol>
    </div>
  
    <div class="sci-body solo">
      <div id="sciValue" class="sci-value">—</div>
    </div>
  </section>
  
  

  <!-- Card grid for selecting data sources and features -->
  <div class="card-grid">
    <!-- ISIS card -->
    <a href="{% url 'analysis' 'ISIS' %}" class="card">
      <div class="card-icon-text">
        <span class="card-heading">ISIS Neutron and Muon Source</span>
      </div>
      <div class="card-description">
        Analyse ISIS Experiment Data
      </div>
    </a>
    <!-- CLF card -->
    <a href="{% url 'analysis' 'CLF' %}" class="card">
      <div class="card-icon-text">
        <span class="card-heading">Central Laser Facility</span>
      </div>
      <div class="card-description">
        Analyse CLF Experiment Data
      </div>
    </a>
    <!-- Diamond card with Beta tag -->
    <a href="{% url 'analysis' 'Diamond' %}" class="card">
      <div class="beta-tag">Beta</div>
      <div class="card-icon-text">
        <span class="card-heading">Diamond</span>
      </div>
      <div class="card-description">
        Analyse Diamond Experiment Data
      </div>
    </a>
    <!-- Training card (disabled placeholder) -->
    <div class="card disabled">
      <div class="card-icon-text">
        <span class="card-heading">Training</span>
      </div>
      <div class="card-description">
        Host your own training courses on our platform.
      </div>
    </div>
    <!-- Developer card (disabled placeholder) -->
    <div class="card disabled">
      <div class="card-icon-text">
        <span class="card-heading">Developer</span>
      </div>
      <div class="card-description">
        Use our platform to develop and test software.
      </div>
    </div>
  </div>

  <!-- Chart.js + SCI script -->
  <script>
    (() => {
      const sciCard   = document.querySelector('.sci-card');
      const sciApi    = sciCard.dataset.sciUrl;
      const elValue   = document.getElementById('sciValue');
    
      async function loadSCI() {
        try {
          // default to 'day' behind the scenes; UI stays minimal
          const res = await fetch(`${sciApi}?range=day`, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          elValue.textContent = Number(data.avg_score).toFixed(2);  // no unit
        } catch (e) {
          console.error('SCI fetch failed:', e);
          elValue.textContent = '—';
        }
      }
    
      // ? popover
      const btn = document.getElementById('sciHelpBtn');
      const pop = document.getElementById('sciHelp');
      const x   = document.getElementById('sciHelpClose');
      let open = false, onDoc=null, onEsc=null;
      function openHelp(){ if(open) return; pop.classList.remove('hidden'); btn.setAttribute('aria-expanded','true'); open=true;
        onDoc=(e)=>{ if(!pop.contains(e.target) && e.target!==btn) closeHelp(); };
        onEsc=(e)=>{ if(e.key==='Escape') closeHelp(); };
        document.addEventListener('mousedown', onDoc); document.addEventListener('keydown', onEsc);
      }
      function closeHelp(){ if(!open) return; pop.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); open=false;
        document.removeEventListener('mousedown', onDoc); document.removeEventListener('keydown', onEsc);
      }
      btn.addEventListener('click', ()=> open ? closeHelp() : openHelp());
      x.addEventListener('click', closeHelp);
    
      loadSCI();
    })();
    </script>
    
  

</body>
</html>
